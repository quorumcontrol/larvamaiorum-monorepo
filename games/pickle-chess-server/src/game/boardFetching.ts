import { AStarFinder } from "astar-typescript"
import { fetchBoard } from "../ai/board"
import { TileType } from "../rooms/schema/PickleChessState"
import { randomInt } from "./utils/randoms"

export type RawBoard = number[][]

const pregeneratedBoards: RawBoard[] = [
  [[1, 1, 1, 1, 1, 1, 1, 5, 2, 2, 2, 2], [1, 1, 1, 1, 1, 1, 1, 3, 3, 2, 2, 2], [1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3], [1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 5], [1, 1, 1, 1, 1, 1, 1, 5, 2, 2, 2, 2], [1, 1, 4, 4, 4, 4, 4, 4, 4, 2, 2, 2], [1, 1, 1, 1, 1, 1, 1, 5, 2, 2, 2, 2], [1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3], [1, 1, 1, 1, 1, 1, 1, 3, 3, 2, 2, 2], [1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 5], [1, 1, 1, 1, 1, 1, 1, 5, 2, 2, 2, 2], [1, 1, 4, 4, 4, 4, 4, 4, 4, 2, 2, 2]],
  [[1, 3, 3, 5, 5, 5, 5, 5, 5], [1, 3, 3, 3, 3, 5, 5, 5, 5], [1, 1, 1, 1, 1, 2, 2, 2, 2], [1, 3, 3, 3, 3, 1, 1, 1, 1], [1, 1, 1, 4, 4, 2, 2, 2, 2], [1, 3, 3, 4, 4, 2, 2, 2, 2], [1, 3, 3, 4, 4, 1, 1, 1, 1], [1, 1, 1, 4, 4, 2, 2, 2, 2], [1, 3, 3, 3, 3, 2, 2, 2, 2], [1, 3, 3, 3, 3, 1, 1, 1, 1], [2, 1, 1, 1, 1, 2, 2, 2, 2]],
  [[2, 3, 4, 3, 2, 1, 1, 2, 3], [1, 4, 3, 4, 1, 2, 3, 2, 1], [2, 3, 4, 3, 2, 4, 3, 2, 1], [1, 2, 3, 4, 1, 4, 3, 4, 3], [3, 1, 2, 3, 4, 3, 4, 3, 2], [2, 1, 2, 3, 2, 1, 2, 3, 4], [3, 2, 1, 4, 3, 2, 1, 4, 3], [1, 2, 3, 2, 1, 2, 3, 2, 1], [3, 4, 3, 4, 3, 4, 3, 4, 3], [2, 3, 4, 3, 2, 3, 4, 3, 2], [1, 2, 3, 4, 1, 2, 3, 4, 1], [4, 3, 4, 3, 4, 3, 4, 3, 4], [3, 4, 3, 2, 1, 2, 3, 4, 3], [2, 1, 2, 3, 4, 3, 2, 1, 2], [1, 4, 3, 2, 1, 4, 3, 2, 1]],
  [[2, 3, 4, 3, 1, 3, 2, 3, 2], [3, 2, 3, 1, 3, 2, 3, 1, 3], [1, 3, 2, 3, 1, 3, 2, 3, 2], [2, 3, 1, 3, 2, 3, 1, 3, 2], [1, 3, 2, 3, 1, 3, 2, 3, 2], [2, 3, 1, 3, 2, 3, 1, 3, 2], [3, 2, 3, 1, 3, 2, 3, 1, 3], [1, 3, 2, 3, 4, 3, 2, 3, 1], [3, 1, 3, 2, 3, 1, 3, 2, 3], [2, 3, 2, 3, 1, 3, 2, 3, 2], [3, 1, 3, 2, 3, 1, 3, 2, 3], [1, 3, 2, 3, 1, 3, 2, 3, 2], [2, 3, 1, 3, 2, 3, 1, 3, 2]],
  [[2, 3, 4, 3, 2, 1, 1, 2, 3], [1, 4, 3, 4, 1, 2, 3, 2, 1], [2, 3, 4, 3, 2, 4, 3, 2, 1], [1, 2, 3, 4, 1, 4, 3, 4, 3], [3, 1, 2, 3, 4, 3, 4, 3, 2], [2, 1, 2, 3, 2, 1, 2, 3, 4], [3, 2, 1, 4, 3, 2, 1, 4, 3], [1, 2, 3, 2, 1, 2, 3, 2, 1], [3, 4, 3, 4, 3, 4, 3, 4, 3], [2, 3, 4, 3, 2, 3, 4, 3, 2], [1, 2, 3, 4, 1, 2, 3, 4, 1], [4, 3, 4, 3, 4, 3, 4, 3, 4], [3, 4, 3, 2, 1, 2, 3, 4, 3], [2, 1, 2, 3, 4, 3, 2, 1, 2], [1, 4, 3, 2, 1, 4, 3, 2, 1]],
  [[3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3], [3, 1, 1, 1, 1, 2, 2, 2, 2, 2, 3], [3, 1, 5, 5, 1, 2, 5, 5, 2, 2, 3], [3, 1, 5, 5, 1, 2, 5, 5, 2, 2, 3], [3, 1, 5, 5, 1, 2, 5, 5, 2, 2, 3], [3, 1, 1, 1, 1, 2, 2, 2, 2, 2, 3], [3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3], [3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3], [3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3], [3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3], [3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3], [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3]],
  [[3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3], [3, 1, 1, 1, 1, 2, 2, 2, 2, 2, 3], [3, 1, 5, 5, 1, 2, 5, 5, 2, 2, 3], [3, 1, 5, 5, 1, 2, 5, 5, 2, 2, 3], [3, 1, 5, 5, 1, 2, 5, 5, 2, 2, 3], [3, 1, 1, 1, 1, 2, 2, 2, 2, 2, 3], [3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3], [3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3], [3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3], [3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3], [3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3], [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3]],
  [[2, 3, 2, 3, 2, 3, 2, 3, 2], [2, 4, 2, 4, 2, 4, 2, 4, 2], [2, 3, 2, 3, 2, 3, 2, 3, 2], [3, 4, 3, 4, 3, 4, 3, 4, 3], [3, 5, 3, 5, 3, 4, 3, 5, 3], [2, 4, 2, 4, 2, 5, 2, 4, 2], [3, 5, 3, 5, 3, 5, 3, 5, 3], [2, 4, 2, 4, 2, 4, 2, 4, 2], [2, 3, 2, 3, 2, 3, 2, 3, 2], [1, 1, 1, 1, 1, 1, 1, 1, 1], [3, 3, 3, 3, 3, 3, 3, 3, 3]],
  [[2, 3, 4, 3, 2, 1, 1, 2, 3], [1, 4, 3, 4, 1, 2, 3, 2, 1], [2, 3, 4, 3, 2, 4, 3, 2, 1], [1, 2, 3, 4, 1, 4, 3, 4, 3], [3, 1, 2, 3, 4, 3, 4, 3, 2], [2, 1, 2, 3, 2, 1, 2, 3, 4], [3, 2, 1, 4, 3, 2, 1, 4, 3], [1, 2, 3, 2, 1, 2, 3, 2, 1], [3, 4, 3, 4, 3, 4, 3, 4, 3], [2, 3, 4, 3, 2, 3, 4, 3, 2], [1, 2, 3, 4, 1, 2, 3, 4, 1], [4, 3, 4, 3, 4, 3, 4, 3, 4], [3, 4, 3, 2, 1, 2, 3, 4, 3], [2, 1, 2, 3, 4, 3, 2, 1, 2], [1, 4, 3, 2, 1, 4, 3, 2, 1]],
  [[1, 3, 3, 5, 5, 5, 5, 5, 5], [1, 3, 3, 3, 3, 5, 5, 5, 5], [1, 1, 1, 1, 1, 2, 2, 2, 2], [1, 3, 3, 3, 3, 1, 1, 1, 1], [1, 1, 1, 4, 4, 2, 2, 2, 2], [1, 3, 3, 4, 4, 2, 2, 2, 2], [1, 3, 3, 4, 4, 1, 1, 1, 1], [1, 1, 1, 4, 4, 2, 2, 2, 2], [1, 3, 3, 3, 3, 2, 2, 2, 2], [1, 3, 3, 3, 3, 1, 1, 1, 1], [2, 1, 1, 1, 1, 2, 2, 2, 2]],
  [[2, 2, 4, 2, 2, 2, 5, 2, 4], [2, 2, 4, 2, 5, 2, 4, 2, 3], [2, 3, 5, 2, 4, 2, 4, 2, 4], [2, 2, 4, 2, 5, 2, 4, 2, 3], [2, 3, 5, 2, 4, 2, 4, 2, 4], [5, 2, 4, 2, 3, 2, 4, 2, 5], [2, 2, 5, 2, 4, 2, 3, 2, 4], [2, 3, 4, 2, 5, 2, 4, 2, 5], [2, 2, 5, 2, 4, 2, 3, 2, 4], [2, 3, 4, 2, 5, 2, 4, 2, 5], [2, 2, 5, 2, 4, 2, 5, 2, 4], [5, 2, 4, 2, 3, 2, 4, 2, 3], [2, 3, 5, 2, 4, 2, 4, 2, 4], [2, 2, 4, 2, 5, 2, 4, 2, 3]],
  [[3, 3, 3, 3, 3, 3, 3, 3, 3], [3, 2, 2, 2, 2, 2, 2, 2, 3], [3, 2, 1, 1, 1, 1, 1, 2, 3], [3, 2, 1, 1, 1, 1, 1, 2, 3], [3, 2, 1, 1, 5, 1, 1, 2, 3], [3, 2, 1, 1, 5, 1, 1, 2, 3], [3, 2, 1, 1, 5, 1, 1, 2, 3], [3, 2, 1, 1, 1, 1, 1, 2, 3], [3, 2, 2, 2, 2, 2, 2, 2, 3], [3, 3, 3, 3, 4, 3, 3, 3, 3], [3, 3, 3, 3, 4, 3, 3, 3, 3], [3, 3, 3, 3, 4, 3, 3, 3, 3], [3, 3, 3, 3, 3, 3, 3, 3, 3]],
  [[3, 4, 2, 4, 2, 4, 2, 4, 1], [1, 4, 2, 4, 2, 4, 2, 4, 1], [1, 4, 2, 4, 2, 4, 2, 4, 1], [1, 2, 2, 3, 2, 2, 2, 3, 1], [3, 4, 2, 4, 2, 4, 2, 4, 1], [1, 4, 2, 4, 2, 4, 2, 4, 1], [1, 2, 2, 2, 2, 2, 2, 2, 1], [3, 3, 3, 3, 3, 3, 3, 3, 1], [1, 5, 5, 5, 5, 5, 5, 5, 1], [1, 2, 2, 2, 2, 2, 2, 2, 1], [3, 4, 2, 4, 2, 4, 2, 4, 1]],
  [[4, 2, 3, 2, 4, 1, 1, 2, 1], [2, 3, 2, 4, 1, 4, 2, 3, 4], [1, 4, 2, 3, 4, 1, 1, 4, 3], [4, 1, 3, 2, 1, 3, 4, 2, 3], [3, 2, 3, 3, 1, 2, 2, 1, 1], [2, 2, 2, 1, 3, 4, 1, 4, 2], [1, 1, 1, 3, 2, 1, 3, 3, 4], [3, 3, 3, 2, 4, 3, 2, 2, 2], [2, 2, 2, 4, 3, 2, 1, 1, 1], [1, 1, 1, 1, 2, 4, 3, 4, 3], [4, 4, 4, 3, 1, 2, 2, 3, 2]],
  [[5, 5, 5, 5, 5, 5, 5, 5, 5], [5, 3, 3, 3, 3, 3, 3, 3, 5], [5, 3, 1, 1, 2, 2, 1, 3, 5], [5, 3, 1, 4, 4, 4, 1, 3, 5], [5, 3, 2, 4, 4, 4, 2, 3, 5], [5, 3, 2, 2, 2, 2, 2, 3, 5], [5, 3, 1, 1, 1, 1, 1, 3, 5], [5, 3, 3, 3, 3, 3, 3, 3, 5], [5, 5, 5, 5, 5, 5, 5, 5, 5]],
  [[2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5], [2, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5], [2, 2, 3, 3, 4, 4, 4, 4, 4, 5, 5], [2, 2, 2, 3, 3, 4, 4, 4, 4, 4, 5], [2, 2, 2, 3, 3, 3, 4, 4, 4, 4, 4], [2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4], [2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4], [2, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4], [2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 4], [2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3], [2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3], [2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3], [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3], [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2]],
  [[4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4], [5, 2, 2, 2, 2, 2, 2, 2, 2, 2, 5], [5, 2, 3, 3, 3, 3, 3, 3, 3, 2, 5], [5, 2, 3, 3, 3, 3, 3, 3, 3, 2, 5], [5, 2, 3, 3, 2, 2, 2, 3, 3, 2, 5], [5, 2, 3, 3, 2, 5, 2, 3, 3, 2, 5], [5, 2, 3, 3, 2, 2, 2, 3, 3, 2, 5], [5, 2, 3, 3, 3, 3, 3, 3, 3, 2, 5], [5, 2, 2, 2, 2, 2, 2, 2, 2, 2, 5], [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4]],
  [[2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2], [2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2], [2, 3, 4, 4, 4, 1, 1, 1, 4, 4, 3, 2], [2, 3, 4, 1, 1, 1, 3, 1, 1, 4, 3, 2], [2, 3, 4, 1, 3, 3, 3, 3, 1, 4, 3, 2], [2, 3, 4, 1, 3, 4, 4, 3, 1, 4, 3, 2], [2, 3, 4, 1, 3, 4, 4, 3, 1, 4, 3, 2], [2, 3, 4, 1, 3, 3, 3, 3, 1, 4, 3, 2], [2, 3, 4, 1, 1, 1, 1, 1, 1, 4, 3, 2], [2, 3, 4, 4, 4, 1, 1, 1, 4, 4, 3, 2], [2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2], [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2]],
  [[3, 3, 1, 1, 1, 3, 3, 4, 4], [3, 3, 1, 2, 2, 3, 3, 4, 4], [3, 3, 1, 2, 2, 3, 3, 4, 4], [3, 3, 2, 2, 2, 4, 4, 4, 4], [2, 2, 2, 2, 2, 2, 2, 4, 4], [2, 2, 2, 2, 2, 2, 2, 4, 4], [3, 3, 2, 2, 2, 4, 4, 4, 4], [3, 3, 2, 2, 2, 4, 4, 4, 4], [3, 3, 2, 2, 2, 4, 4, 4, 4], [3, 3, 1, 1, 1, 3, 3, 4, 4], [2, 2, 1, 1, 1, 2, 2, 4, 4], [3, 3, 1, 1, 1, 3, 3, 4, 4], [3, 3, 2, 2, 2, 4, 4, 4, 4], [2, 2, 2, 2, 2, 2, 2, 4, 4], [3, 3, 2, 2, 2, 4, 4, 4, 4]],
  [[1, 1, 1, 1, 1, 1, 2, 2, 2], [1, 1, 3, 3, 3, 1, 1, 1, 2], [1, 1, 3, 3, 3, 1, 1, 1, 2], [1, 2, 2, 3, 3, 3, 3, 1, 2], [1, 2, 2, 3, 3, 3, 3, 1, 2], [1, 2, 2, 2, 1, 1, 1, 1, 1], [4, 4, 4, 2, 1, 1, 1, 1, 1], [4, 4, 4, 4, 4, 4, 4, 1, 1], [4, 4, 4, 4, 4, 4, 4, 1, 1], [4, 4, 4, 4, 4, 4, 4, 1, 1]],
  [[3, 3, 3, 3, 3, 3, 5, 1, 1, 1, 1], [3, 3, 3, 3, 3, 5, 1, 1, 1, 1, 1], [3, 3, 3, 3, 5, 1, 1, 1, 2, 1, 1], [3, 3, 3, 5, 1, 1, 1, 2, 2, 2, 1], [3, 3, 5, 1, 1, 1, 2, 2, 2, 2, 2], [3, 5, 1, 1, 1, 2, 2, 2, 2, 2, 2], [5, 1, 1, 1, 2, 2, 2, 2, 2, 2, 1], [1, 1, 1, 2, 2, 2, 2, 2, 2, 1, 1], [1, 1, 2, 2, 2, 2, 2, 2, 1, 1, 1], [1, 2, 2, 2, 2, 2, 2, 1, 1, 1, 4], [4, 4, 4, 4, 4, 4, 1, 1, 1, 4, 4]],
  [[1, 1, 1, 1, 1, 2, 2, 3, 3, 3, 3], [1, 1, 1, 1, 1, 2, 2, 3, 3, 3, 3], [1, 1, 1, 1, 1, 1, 2, 3, 3, 3, 3], [1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2], [1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2], [1, 1, 1, 1, 2, 3, 3, 3, 3, 3, 3], [1, 1, 1, 1, 2, 3, 4, 4, 4, 4, 4], [1, 1, 2, 2, 2, 3, 4, 5, 5, 5, 5], [1, 1, 2, 2, 2, 3, 4, 5, 5, 5, 5], [1, 1, 2, 2, 2, 3, 4, 5, 5, 5, 5], [1, 1, 2, 2, 2, 3, 4, 5, 5, 5, 5]],
  [[1, 1, 1, 1, 1, 1, 1, 3, 3], [1, 1, 1, 1, 1, 1, 3, 3, 3], [1, 1, 1, 1, 1, 3, 3, 3, 3], [1, 1, 1, 1, 3, 3, 2, 2, 2], [1, 1, 1, 3, 3, 2, 2, 2, 1], [1, 1, 3, 3, 2, 2, 2, 1, 1], [1, 3, 3, 2, 2, 2, 1, 1, 1], [3, 3, 2, 2, 2, 1, 1, 1, 1], [3, 3, 2, 2, 1, 1, 1, 1, 1]],
  [[1, 1, 1, 2, 2, 2, 1, 1, 1], [1, 1, 2, 2, 2, 2, 2, 1, 1], [1, 2, 2, 3, 3, 3, 2, 2, 1], [2, 2, 3, 3, 4, 3, 3, 2, 2], [2, 2, 3, 4, 4, 4, 3, 2, 2], [2, 3, 4, 4, 4, 4, 4, 3, 2], [1, 2, 3, 3, 4, 3, 3, 2, 1], [1, 1, 2, 2, 2, 2, 2, 1, 1], [1, 1, 1, 2, 2, 2, 1, 1, 1]],
  [[1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2], [1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2], [1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2], [1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2], [3, 3, 3, 3, 2, 2, 2, 4, 4, 4, 4], [3, 3, 3, 3, 2, 2, 2, 4, 4, 4, 4], [3, 3, 3, 3, 2, 2, 2, 4, 4, 4, 4], [1, 1, 1, 1, 4, 4, 4, 4, 4, 4, 4], [1, 1, 1, 1, 4, 4, 4, 4, 4, 4, 4], [1, 1, 1, 1, 4, 4, 4, 4, 4, 4, 4], [1, 1, 1, 1, 4, 4, 4, 4, 4, 4, 4]],
  [[4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5], [4, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 5], [4, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 5], [4, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 5], [4, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 5], [4, 1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 3], [4, 1, 1, 1, 2, 2, 2, 3, 3, 3, 3, 3], [4, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 3], [4, 4, 4, 4, 4, 4, 4, 3, 3, 3, 3, 3], [4, 4, 4, 4, 4, 4, 4, 3, 3, 3, 3, 3], [4, 4, 4, 4, 4, 4, 4, 3, 3, 3, 3, 3]],
  [[2, 2, 3, 3, 3, 3, 3, 2, 2], [2, 2, 3, 1, 1, 1, 3, 2, 2], [3, 3, 1, 5, 5, 5, 1, 3, 3], [3, 1, 5, 4, 4, 4, 5, 1, 3], [3, 1, 5, 4, 4, 4, 5, 1, 3], [3, 1, 5, 4, 4, 4, 5, 1, 3], [3, 3, 1, 5, 5, 5, 1, 3, 3], [2, 2, 3, 1, 1, 1, 3, 2, 2], [2, 2, 3, 3, 3, 3, 3, 2, 2]],
  [[1, 1, 1, 2, 2, 2, 2, 2, 2, 2], [1, 1, 1, 1, 1, 1, 1, 3, 3, 3], [1, 1, 1, 1, 1, 1, 3, 3, 3, 3], [1, 1, 1, 1, 1, 3, 3, 3, 5, 5], [1, 1, 1, 1, 1, 3, 3, 5, 5, 5], [1, 1, 1, 1, 3, 3, 5, 5, 5, 4], [1, 1, 1, 3, 3, 5, 5, 5, 4, 4], [1, 1, 3, 3, 5, 5, 5, 4, 4, 4], [1, 3, 3, 5, 5, 5, 4, 4, 4, 4], [3, 3, 5, 5, 5, 4, 4, 4, 4, 5]],
  [[1, 1, 1, 1, 1, 1, 1, 1, 2, 2], [1, 1, 1, 3, 3, 3, 1, 1, 2, 2], [1, 1, 1, 3, 3, 3, 1, 1, 2, 2], [1, 3, 3, 3, 3, 3, 3, 1, 1, 1], [1, 3, 3, 4, 4, 4, 3, 3, 3, 3], [3, 3, 3, 4, 4, 4, 3, 3, 3, 3], [3, 3, 3, 4, 4, 4, 3, 3, 3, 3], [1, 1, 1, 3, 3, 3, 1, 1, 2, 2], [1, 1, 1, 3, 3, 3, 1, 1, 2, 2], [1, 1, 1, 1, 1, 1, 1, 1, 2, 2]],
  [[1, 1, 1, 1, 1, 1, 4, 4, 4, 4], [1, 1, 1, 1, 1, 1, 4, 4, 4, 4], [1, 1, 1, 2, 2, 2, 2, 4, 4, 4], [1, 1, 1, 2, 2, 2, 2, 2, 2, 2], [1, 1, 1, 2, 2, 2, 2, 2, 2, 2], [1, 1, 1, 2, 2, 2, 2, 2, 2, 2], [1, 1, 1, 2, 2, 2, 2, 4, 4, 4], [4, 4, 4, 2, 2, 2, 2, 4, 4, 4], [4, 4, 4, 4, 4, 4, 4, 4, 4, 4]],
]

const bigBoards = [
  [[2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3],
  [1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 2, 2, 2],
  [2, 4, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
  [2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 1, 2],
  [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 5, 5, 5, 5, 5, 5],
  [2, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5],
  [2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 5, 5, 5, 5, 5, 5],
  [2, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5],
  [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3, 3],
  [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3],
  [2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
  [2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
  [2, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
  [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
  [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
  [2, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 2, 2, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
  [2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2]
  ],
  [[2, 3, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 2, 2],
  [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4],
  [2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4],
  [2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4],
  [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4],
  [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 1, 1],
  [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 1, 1],
  [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 2, 2, 2, 2],
  [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 2, 2, 2, 2],
  [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 2, 2, 2, 2],
  [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 2, 2, 2, 2],
  [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 2, 2, 2, 2],
  [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 2, 2, 2, 2],
  [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 2, 2, 2, 2],
  [3, 3, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1],
  [3, 3, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1],
  [3, 3, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],],
  [[1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4],
  [2, 3, 3, 3, 3, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5],
  [3, 3, 5, 3, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4],
  [4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3],
  [5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 2, 1, 2, 3, 4],
  [4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1],
  [3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2],
  [2, 1, 2, 3, 3, 3, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3],
  [1, 2, 3, 4, 3, 3, 3, 2, 1, 2, 3, 4, 3, 2, 1, 2, 3, 4, 5, 4],
  [2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5],
  [3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4],
  [4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3],
  [5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 3, 2, 1, 2],
  [4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1],
  [3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2],
  [2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3],
  [1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 3, 2, 1, 2, 3, 4, 5, 4],
  [2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5],
  [3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4],
  [4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3],
  [5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 2, 1, 2, 3, 4],
  [4, 3, 2, 1, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4],
  [3, 2, 1, 2, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5],
  [2, 1, 2, 3, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 3, 4],
  [1, 2, 3, 4, 2, 1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5, 4, 3]],
  [[2, 3, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3],
  [2, 3, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 4, 4],
  [2, 3, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 4, 4, 5],
  [2, 3, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 4, 5, 5],
  [2, 3, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 4, 5, 5],
  [2, 3, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 4, 5, 5],
  [2, 3, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 4, 5, 5],
  [2, 3, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 4, 5, 5],
  [2, 3, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 4, 5, 5],
  [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 2, 2, 2, 2, 4, 5, 5],
  [1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 4, 5, 5],
  [1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 4, 5, 5],
  [1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 4, 5, 5],
  [1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 4, 5, 5],
  [1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 4, 5, 5],
  [1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 4, 5, 5],
  [1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 4, 5, 5],
  [1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 4, 5, 5],
  [1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 4, 5, 5],
  [1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 4, 5, 5],
  [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 2, 2, 2, 2, 4, 5, 5],
  [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 2, 2, 2, 2, 4, 4, 4],
  [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3, 3, 3, 3],
  [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
  [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
  [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
  [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4],
  [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 5, 5],
  [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 5, 5, 5]],
]

const boardRegex = /\[\s*(\[(\s*\d+,\s*)+\d+\],?\s*)+\]/

export const createNewAiBoard = async (numberOfPlayers: number): Promise<RawBoard> => {
  const aiResponse = await fetchBoard(numberOfPlayers)
  console.log("ai response: ", aiResponse)
  const text = aiResponse.match(boardRegex)[0]
  const board = JSON.parse(text.trim())
  console.log("board: ", board)
  if (!validateBoard(board)) {
    console.error("invalid board: ", board)
    return createNewAiBoard(numberOfPlayers)
  }
  return board
}

export const getBoardById = (id: number) => {
  return pregeneratedBoards[id]
}

export const getAiBoard = async (numberOfPlayers: number): Promise<RawBoard> => {
  // return latest
  // return bigBoards[3]
  // return pregeneratedBoards[0]
  try {
    return await createNewAiBoard(numberOfPlayers)
  } catch (err) {
    console.error("oops: ", err)
    if (numberOfPlayers > 3) {
      return bigBoards[randomInt(bigBoards.length)]
    }

    const rand = randomInt(pregeneratedBoards.length)
    console.log("using board: ", rand)
    return pregeneratedBoards[rand]
  }

}

export const validateBoard = (board: RawBoard) => {
  const aStar = new AStarFinder({
    grid: {
      matrix: board.map((column) => column.map((tile) => {
        if ([TileType.water, TileType.stone].includes(tile)) {
          return 1
        }
        return 0
      }))
    },
    diagonalAllowed: true,
    includeEndNode: true,
    includeStartNode: false,
  });
  
  // for every accessible tile on the board, make sure that it can reach every other reachable tile.

  const reachableTiles = board.reduce((acc, column, y) => {
    column.forEach((tile, x) => {
      if (tile < TileType.water) {
        acc.push({ x, y })
      }
    })
    return acc
  }, [] as { x: number, y: number }[])

  console.log("reachable tiles: ", reachableTiles)

  return reachableTiles.every((start) => {
    return reachableTiles.every((end) => {
      if (start.x === end.x && start.y === end.y) {
        return true
      }
      const path = aStar.findPath(start, end)
      if (path.length === 0) {
        console.log("no path from ", start, " to ", end)
        return false
      }
      return true
    })
  })
}
